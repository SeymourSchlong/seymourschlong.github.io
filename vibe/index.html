<!doctype html>
<html>
    <head>
        <title>groovy!</title>
        <meta name="og:title" content="Groovy!">
        <meta name="theme-color" content="#dcded9">
        <meta name="og:image" content="https://github.com/SeymourSchlong/seymourschlong.github.io/blob/master/vibe/groove.gif?raw=true">
        <link rel="icon" type="image/png" href="icon.png">
        <link id="script-css" type="text/css" rel="stylesheet" href="style.css">
    </head>
    <body>
        <div id="main">
            <video loop><source src="vibe.mp4" type="video/mp4">Your browser does not support the video tag.</video>
            <br>
            <span><div id="playback" class="play" onclick="togglePlay(this)"></div>BPM: <input type="number" min="0" max="2022" size="5" value="126" placeholder="BPM" onchange="updateBpm(this.value)"></span>
        </div>
        <script>
            const bpm = 126.4;

            const video = document.querySelector('video');
            const bpminput = document.querySelector('input');
            const mediaButton = document.querySelector('#playback');

            video.addEventListener('pause', () => {
                mediaButton.className = 'play';
            });
            video.addEventListener('play', () => {
                mediaButton.className = 'pause';
            });

            const updateBpm = (newbpm) => {
                try {
                    video.playbackRate = newbpm / bpm;
                    video.play();
                    window.history.replaceState({}, null, `/vibe/?bpm=${parseFloat(bpminput.value)}`);
                } catch(err) {}
            }

            const togglePlay = (div) => {
                if (video.paused) {
                    video.play();
                } else {
                    video.pause();
                }
            }

            let rawParams;
            if (location.href.indexOf("#") != -1) {
                rawParams = location.href.slice(0, location.href.indexOf("#"));
            } else {
                rawParams = location.href;
            }
            if (rawParams.indexOf("?") != -1) {
                rawParams = rawParams.slice(rawParams.indexOf("?") + 1).split("&");
            } else {
                rawParams = [];
            }
            const params = {};
            for (let i = 0; i < rawParams.length; i++) {
                try {
                    const p = rawParams[i].split("=");
                    params[p[0]] = decodeURIComponent(p[1]);
                } catch (err) {}
            }

            if (parseFloat(params.bpm)) {
                video.playbackRate = parseFloat(params.bpm) / bpm;
                bpminput.value = parseFloat(params.bpm);
            }
        </script>
    </body>
</html>
