<!doctype html>
<html>
  <head>
    <title>groovy!</title>
    <meta name="og:title" content="Groovy!">
    <meta name="theme-color" content="#dcded9">
    <meta name="og:image" content="groove.gif">
    <link rel="icon" type="image/png" href="icon.png">
    <link id="script-css" type="text/css" rel="stylesheet" href="style.css">
  </head>
  <body>
    <div id="main">
      <video autoplay loop controls><source src="vibe.mp4" type="video/mp4">Your browser does not support the video tag.</video>
      <br>
      <input type="number" min="0" max="2022" size="5" value="126" placeholder="BPM" onchange="updateBpm(this.value)">
    </div>
    <script>
        let bpm = 126.4;
        let songbpm = bpm;
        let rate = 1;

        let video = document.querySelector('video');

        const updateBpm = (newbpm) => {
          try {
            songbpm = newbpm;
            rate = songbpm / bpm;
            video.playbackRate = rate;
            video.play();
          } catch(err) {}
        }

        let rawParams;
        if (location.href.indexOf("#") != -1) {
            rawParams = location.href.slice(0, location.href.indexOf("#"));
        } else {
            rawParams = location.href;
        }
        if (rawParams.indexOf("?") != -1) {
            rawParams = rawParams.slice(rawParams.indexOf("?") + 1).split("&");
        } else {
            rawParams = [];
        }
        const params = {};
        for (let i = 0; i < rawParams.length; i++) {
            try {
                const p = rawParams[i].split("=");
                params[p[0]] = decodeURIComponent(p[1]);
            } catch (err) {}
        }
      
        if (parseFloat(params.bpm)) {
            updateBpm(parseFloat(params.bpm));
            document.querySelector('input').value = parseFloat(params.bpm);
        }
    </script>
  </body>
</html>
